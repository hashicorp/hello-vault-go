version: "3.9"
services:
  api:
    build: .
    environment:
      SECRET_ID: "<secret id here>"
      APPROLE_ROLE_ID: "<app role id here>"
    ports:
      - "8080:8080"
    depends_on:
      - db
      - vault

  db:
    image: postgres:14.0
    restart: always
    environment:
      POSTGRES_PASSWORD: rootpassword
    volumes:
      - "dbdata:/var/lib/postgresql/data"
      - "./setup/db-scripts:/docker-entrypoint-initdb.d/"
    ports:
      - "5432:5432"

  vault:
    image: vault:latest
    volumes:
      - "vaultdata:/vault/file"
      - "./setup/vault-server:/vault/env"
    ports:
      - "8200:8200"
    command:
      - "server"

volumes:
  dbdata:
  vaultdata:
